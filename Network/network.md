***
### 1. 分层

OSI 7层和 TCP/IP 5层：
![network layoer](/Image/networkLayer.png)

从一般概念上讲，计算机或网络互连要使用一些中间设备：
- 物理层 —— 转发器
- 数据链路层 —— 网桥或桥接器
- 网络层 —— 路由器
- 网络层以上 —— 网关
转发器和网桥仅仅是把一个网络扩大了，路由器连接网络。

##### 1.1 物理层
1. 为设备之间的数据通信提供传输媒体(电缆、光纤、无线信道)及互连设备。
2. 传输数据(比特流(0, 1)信号)。
##### 1.2 数据链路层
要在一条线路上传递数据，除了必须有一条物理线路外，还必须有一些通信协议来控制这些数据的传输，若把这些实现协议的软件硬件加到物理链路上，就构成了数据链路。

主要功能(为网络层提供数据传送服务)：
1. 封装成帧(frame)：接收端能够从物理层上交的比特流中根据首尾部标记识别出帧，并取出数据
2. 透明传输：无论什么样的比特组合都能够通过，对首尾标识以及转义字符的转义
3. 差错检测：比特在传输过程中可能出错(循环冗余检验)：
    - 在通信质量良好的有线链路，数据链路层丢弃错误帧，即只保证接收的帧无差错，确认和重传由上层协议来完成。(帧比较小，正确率高的情况下每一帧都要确认比较耗费资源)
    - 在通信质量差的无限链路，数据链路层使用确认和重传机制，向上提供可靠传输的服务。(正确率低时，上层数据报频繁重发会使得很多成功发送的帧重发)

数据链路层最常见的独立产品是网卡(计算机MAC地址)，网桥(根据MAC帧的目的地址对收到的帧进行转发和过滤)。

数据链路层的信道主要分为：
1. 点对点信道，PPP协议
2. 广播信道，CSMA/CD协议(以太网)

##### 1.3 网络层
发送数据时，网络层负责把运输层产生的报文段或用户数据报封装成`IP数据报(datagram)`进行传送；另一个任务是选择合适的路由，使得IP数据报能够通过网络中的路由器找到目的主机(也就是路由或寻径)。

网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务，所传送的分组可能出错、丢失、重复和失序。

###### 1.3.1 网际协议IP
网际协议IP是作用是使互连起来的许多计算机网络之间能够进行通信，与之配套使用的还有ARP,ICMP,IGMP。

IP协议可以使各个性能各异的网络在网络层看起来像是一个同一个的网络。

IP地址特点：
- IP地址一般有两个部分组成：网络号和主机号。A类、B类和C类地址的区分已成为历史。
- IP地址是32位的二进制代码，为提高可读性，使用点分十进制记法。
- 网络号全0 表示“本网络”，主机号全0表示“本主机”；网络号为 127 保留作为本地软件环回测试本主机的进程之间的通信只用，主机号全 1 表示该网络上的所有主机。
- 一个网络指具有相同网络号的主机的集合，因此用转发器或网桥连接起来的若干个局域网仍为一个网络。路由器每一个接口都有一个不同网络号的IP地址。

IP地址与硬件地址(物理地址、MAC地址)：
- 硬件地址是数据链路层和物理层使用的地址，IP地址是网络层及以上使用的地址，是一种逻辑地址。
- 使用IP地址(首部中)的IP数据报在数据链路层被封装成MAC帧，MAC帧在传送时使用的源地址和目的地址都是硬件地址(MAC帧首部中)。
- 在路由其中转发时，IP数据报首部中的源地址和目的地址始终都不会变化，而MAC帧首部中的源地址和目的地址都要发生变化。

网络层抽象的互联网屏蔽了下层复杂的细节，使我们得在网络层上讨论问题时，能够使用统一的、抽象的IP地址研究主机和主机或路由器之间的通信。

###### 1.3.2 ARP
ARP解决的是(同一个局域网上)已知一个机器(主机或路由器)的IP地址，需要找出其相应的硬件地址的问题。

网络层使用的是IP地址，但实际在网络的链路上传送数据帧时，还是必须使用网络的硬件地址。但IP地址和MAC地址由于格式不同而没有简单的映射关系，且主机的加入、撤走，更换网卡都可能导致MAC地址改变。ARP的解决办法就是在主机ARP高速缓存中存放本局域网上各主机从IP地址到MAC地址的映射表，且该表经常动态更新(新增或超市删除)。

ARP特点：
- 当一个主机向另一个主机发送数据时，若在映射表中找不到目的主机的IP地址项目，则源主机自动运行ARP,ARP进程在局域网广播发送一个APR请求分组，对应的主机会以单播的形式相应分组。
- ARP把映射表中的每一个项目都设置生存时间，超过生存时间的就删除。
- 从IP地址到硬件地址的解析是自动进行的，主机用户对这种地址解析过程并不知情。只要主机要和本网络上的一个已知IP地址的主机或路由器进行通信，ARP协议就会将IP地址解析为MAC地址。

##### 1.4 运输层
运输层负责向两个主机的进程之间的通信提供**通用**的数据传输服务。

通用：多个应用可以使用同一个运输层服务，而一台主机可以同事运行多个进程，因此运输层有**复用**和**分用**的功能。复用指多个应用进程可同时使用下面运输层的服务，分用则指运输层把收到的信息分别交付上面应用层中的相应进程。

主要使用协议：
- 传输控制协议TCP(Transmission Control Protocol): 提供面向连接的、可靠的数据传输服务，数据传输单位指报文段(segment)。
- 用户数据报协议UDP(User Datagram Protocol): 提供无连接的，尽最大努力的数据传输服务，数据传输的单位是用户数据报。

##### 1.5 应用层
应用层的任务是通过应用进程间的交互来完成特定网络应用。应用层的数据单元是报文(message)

参考：
- https://juejin.im/post/5de372c2f265da060078039a
- https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E4%B8%83%E5%B1%82%E5%8D%8F%E8%AE%AE
